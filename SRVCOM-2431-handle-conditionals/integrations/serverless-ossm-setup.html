

<!DOCTYPE html>
<!--[if IE 8]> <html class="ie8"> <![endif]-->
<!--[if IE 9]> <html class="ie9"> <![endif]-->
<!--[if gt IE 9]><!-->
<html>
<!--<![endif]-->

<head>
  <meta charset="utf-8">
  <meta content="IE=edge" http-equiv="X-UA-Compatible">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  
  
  
  <title>Integrating Service Mesh with OpenShift Serverless | Integrations | OpenShift Serverless Branch Build</title>
  <link href="https://assets.openshift.net/content/subdomain.css" rel="stylesheet" type="text/css"/>
  <link href="https://docs.openshift.com/container-platform/4.1/_stylesheets/search.css" rel="stylesheet" media="screen"/>
  <link href="https://docs.openshift.com/container-platform/4.1/_stylesheets/autumn.css" rel="stylesheet"  media="screen"/>
  <link href="https://assets.openshift.net/content/subdomain/touch-icon-precomposed.png" rel="apple-touch-icon-precomposed" type="image/png"/>
  <link href="https://assets.openshift.net/content/subdomain/favicon32x32.png" rel="shortcut icon" type="text/css"/>
  <link href="https://assets.openshift.net/content/osh-nav-footer.css" rel="stylesheet" type="text/css" media="screen"/>
  <link href="https://docs.openshift.com/container-platform/4.1/_stylesheets/docs.css" rel="stylesheet"  media="screen"/>
  <link href="https://docs.openshift.com/container-platform/4.1/_stylesheets/print.css" rel="stylesheet" type="text/css" media="print"/>
  <!--[if IE]><link rel="shortcut icon" href="https://assets.openshift.net/content/subdomain/favicon.ico"><![endif]-->
  <!-- or, set /favicon.ico for IE10 win -->
  <meta content="OpenShift" name="application-name">
  <meta content="#000000" name="msapplication-TileColor">
  <meta content="https://assets.openshift.net/content/subdomain/touch-icon-precomposed.png" name="msapplication-TileImage">

  <!-- Adobe DTM -->
  <script src="//www.redhat.com/dtm.js" type="text/javascript"></script>
  <!-- End Adobe DTM -->

  <script id="trustarc" src="https://static.redhat.com/libs/redhat/marketing/latest/trustarc/trustarc.js"></script>

  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined"
        rel="stylesheet">

</head>

<body onload="selectVersion('Branch Build');">
  
<nav id="main">
  <div class="container">
    <div class="row">
      <div class="navbar navbar-default navbar-openshift" role="navigation">
        <div class="navbar-header">
            <a href="#nav-main" class="dropdown-toggle navbar-menu-toggle hidden visible-xs" data-toggle="collapse">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </a>
          <a class="navbar-brand" href="/"></a>
        </div>
        <div id="nav-main" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li id="products" class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-expanded="true">
                Products <span class="fa fa-angle-down"></span>
              </a>
              <div class="dropdown-menu">
                <div class="row flex-column flex-md-row">
                  <div class="col-xs-12 col-sm-3">
                    <h3>Overview</h3>
                    <ul class="nav flex-column">
                      <li><a target="_blank" href="https://www.openshift.com/products/features/">Features</a></li>
                      <li><a target="_blank" href="https://www.openshift.com/products/pricing/">Pricing</a></li>
                    </ul>
                  </div>
                  <div class="col-xs-12 col-sm-9">
                    <h3>Featured Products</h3>
                    <ul class="nav">
                      <li>
                        <a target="_blank" href="https://www.openshift.com/products/container-platform/">Red Hat OpenShift Container&nbsp;Platform</a>
                        <p class="d-none d-md-block">Build, deploy and manage your applications across cloud- and on-premise infrastructure</p>
                      </li>
                      <li>
                        <a target="_blank" href="https://www.openshift.com/products/dedicated/">Red Hat OpenShift Dedicated</a>
                        <p class="d-none d-md-block">Single-tenant, high-availability Kubernetes clusters in the public cloud</p>
                      </li>

                      <li>
                        <a target="_blank" href="https://www.openshift.com/products/online/">Red Hat OpenShift Online</a>
                        <p class="d-none d-md-block">The fastest way for developers to build, host and scale applications in the public cloud</p>
                      </li>

                      <li class="nav-item">
                        <a target="_blank" href="https://www.openshift.com/products/">All products <span class="fa fa-angle-right"></span></a>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </li>

            <li id="learn" class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                Learn <span class="fa fa-angle-down"></span>
              </a>
              <div class="dropdown-menu">
                <div class="row flex-md-nowrap">
                  <div class="col-xs-12 col-sm-6">
                    <h3>Learn</h3>
                    <ul class="nav">
                      <li><a target="_blank" href="https://www.openshift.com/learn/what-is-openshift/">What is OpenShift</a></li>
                      <li><a target="_blank" href="https://www.openshift.com/learn/get-started/">Get started</a></li>
                      <li><a target="_blank" href="https://www.openshift.com/learn/partners/">Partners</a></li>
                      <li><a target="_blank" href="https://www.openshift.com/learn/success-stories/">Customer success stories</a></li>
                      <li><a target="_blank" href="https://blog.openshift.com">Blog</a></li>
                      <li><a target="_blank" href="https://www.openshift.com/learn/resources/">Resources</a></li>
                    </ul>
                  </div>
                  <div class="col-xs-12 col-sm-6">
                    <h3>Technology Topics</h3>
                    <ul class="nav">
                      <li><a target="_blank" href="https://www.openshift.com/learn/topics/knative/">Knative</a></li>
                      <li><a target="_blank" href="https://www.openshift.com/learn/topics/security/">Security</a></li>
                      <li><a target="_blank" href="https://www.openshift.com/learn/topics/kubernetes/">Kubernetes</a></li>
                      <li><a target="_blank" href="https://www.openshift.com/learn/topics/service-brokers/">Service Brokers</a></li>
                    </ul>
                  </div>
                </div>
              </div>
            </li>

            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                Community <span class="fa fa-angle-down"></span>
              </a>
              <ul class="dropdown-menu">
                <li><a target="_blank" href="https://commons.openshift.org">OpenShift Commons</a></li>
                <li><a target="_blank" href="https://www.okd.io">Open Source (OKD)</a></li>
                <li><a target="_blank" href="https://www.openshift.com/community/programs/startups/">Startups</a></li>
                <li><a target="_blank" href="https://www.openshift.com/community/programs/grants/">Grants</a></li>
              </ul>
            </li>

            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                Support <span class="fa fa-angle-down"></span>
              </a>
              <ul class="dropdown-menu">
                <li><a target="_blank" href="https://help.openshift.com">Help Center</a></li>
                <li><a href="https://docs.openshift.com">OpenShift Docs</a></li>
              </ul>
            </li>

            <li><a target="_blank" class="nav-sign-up" href="https://www.openshift.com/trial/">Free Trial</a></li>

            <li><a target="_blank" href="https://console.redhat.com/openshift" class="nav-sign-in">Log In <span class="fa fa-angle-right"></span></a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</nav>

  
  <div class="container">
    <button id="hc-open-btn" class="open-btn-sm" onclick="openNav()" aria-label="Open"><span class="fa fa-bars" /></button>
    <ol class="breadcrumb hide-for-print">
      

      

      

      

      

      <li class="sitename">
        <a href="/">
          Documentation</a>
      </li>
      <li class="hidden-xs active">
        
          
              
                <a href="../about/serverless-release-notes.html">OpenShift Serverless Branch Build</a>
              
        
        
      </li>
      <li class="hidden-xs active">
        <a href="../integrations/serverless-ossm-setup.html">Integrations</a>
      </li>
      
      
      <li class="hidden-xs active">
        Integrating Service Mesh with OpenShift Serverless
      </li>
      
      <span text-align="right" style="float: right !important">
        <a href="https://github.com/openshift/openshift-docs/commits/main/integrations/serverless-ossm-setup.adoc"><span class="material-icons-outlined" title="Page history">history</span></a>
        
        <a href="https://issues.redhat.com/secure/CreateIssueDetails!init.jspa?pid=12332330&issuetype=1&components=12367614&priority=4&summary=Issue+in+file+integrations/serverless-ossm-setup.adoc">
          <span class="material-icons-outlined" title="Open an issue">bug_report</span>
        </a>
        <a href="javascript: void(0);" onclick="window.print()"><span class="material-icons-outlined" title="Print page (Save as PDF)">picture_as_pdf</span></a>
        
        
      </span>
      
    </ol>
    <div class="row row-offcanvas row-offcanvas-left">
      <div class="col-xs-8 col-sm-3 col-md-3 sidebar sidebar-offcanvas hide-for-print">
        <div class="row-fluid">
          <div id="btn-close">
            <button id="hc-close-btn" onclick="closeNav()" class="close-btn-sm" aria-label="close"><span class="fa fa-times" /></button>
          </div>
          <div id="hc-search">
            <input id="hc-search-input" type="text" aria-label="search">
            <button id="hc-search-btn" aria-label="search"><span class="fa fa-search" /></button>
          </div>
        </div>
        <ul class="nav nav-sidebar">
    <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup0"><span id="tgSpan0" class="fa fa-angle-right"></span>About Serverless</a>
      <ul id="topicGroup0" class="collapse  list-unstyled">
            <li><a class="" href="../about/serverless-release-notes.html">Release notes</a></li>
            <li><a class="" href="../about/about-serverless.html">Serverless overview</a></li>
            <li><a class="" href="../about/about-knative-serving.html">Knative Serving overview</a></li>
            <li><a class="" href="../about/about-knative-eventing.html">Knative Eventing overview</a></li>
            <li><a class="" href="../about/serverless-functions-about.html">Serverless Functions overview</a></li>
            <li><a class="" href="../about/serverless-support.html">Serverless support</a></li>
      </ul>
    </li>
    <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup1"><span id="tgSpan1" class="fa fa-angle-right"></span>Installing Serverless</a>
      <ul id="topicGroup1" class="collapse  list-unstyled">
            <li><a class="" href="../install/preparing-serverless-install.html">Preparing to install OpenShift Serverless</a></li>
            <li><a class="" href="../install/install-serverless-operator.html">Installing the Serverless Operator</a></li>
            <li><a class="" href="../install/installing-kn.html">Installing the Knative CLI</a></li>
            <li><a class="" href="../install/installing-knative-serving.html">Installing Knative Serving</a></li>
            <li><a class="" href="../install/installing-knative-eventing.html">Installing Knative Eventing</a></li>
            <li><a class="" href="../install/serverless-kafka-admin.html">Configuring Knative for Apache Kafka</a></li>
            <li><a class="" href="../install/configuring-serverless-functions.html">Configuring Serverless Functions</a></li>
            <li><a class="" href="../install/serverless-upgrades.html">Serverless upgrades</a></li>
      </ul>
    </li>
    <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup2"><span id="tgSpan2" class="fa fa-angle-right"></span>Serving</a>
      <ul id="topicGroup2" class="collapse  list-unstyled">
            <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-2-0"><span id="sgSpan-2-0" class="fa fa-caret-right"></span>&nbsp;Getting started with Knative Serving</a>
              <ul id="topicSubGroup-2-0" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../knative-serving/getting-started/serverless-applications.html">Creating Serverless applications</a></li>
                  <li><a class="" href="../knative-serving/getting-started/verifying-application-deployment.html">Verifying application deployment</a></li>              </ul>
            </li>
            <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-2-1"><span id="sgSpan-2-1" class="fa fa-caret-right"></span>&nbsp;Autoscaling</a>
              <ul id="topicSubGroup-2-1" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../knative-serving/autoscaling/serverless-autoscaling-developer.html">Autoscaling overview</a></li>
                  <li><a class="" href="../knative-serving/autoscaling/serverless-autoscaling-developer-scale-bounds.html">Scale bounds</a></li>
                  <li><a class="" href="../knative-serving/autoscaling/serverless-concurrency.html">Concurrency</a></li>
                  <li><a class="" href="../knative-serving/autoscaling/serverless-autoscaling-scale-to-zero.html">Scale-to-zero</a></li>              </ul>
            </li>
            <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-2-2"><span id="sgSpan-2-2" class="fa fa-caret-right"></span>&nbsp;Configuring Serverless applications</a>
              <ul id="topicSubGroup-2-2" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../knative-serving/config-applications/overriding-config-serving.html">Overriding system deployment configurations</a></li>
                  <li><a class="" href="../knative-serving/config-applications/multi-container-support-for-serving.html">Multi-container support</a></li>
                  <li><a class="" href="../knative-serving/config-applications/empty-dir.html">EmptyDir volumes</a></li>
                  <li><a class="" href="../knative-serving/config-applications/pvcs-for-serving.html">Persistent Volume Claims</a></li>
                  <li><a class="" href="../knative-serving/config-applications/init-containers.html">Init containers</a></li>
                  <li><a class="" href="../knative-serving/config-applications/resolving-image-tags-to-digests.html">Resolving image tags to digests</a></li>
                  <li><a class="" href="../knative-serving/config-applications/serverless-config-tls.html">Configuring TLS authentication</a></li>
                  <li><a class="" href="../knative-serving/config-applications/restrictive-network-policies.html">Restrictive network policies</a></li>              </ul>
            </li>
            <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-2-3"><span id="sgSpan-2-3" class="fa fa-caret-right"></span>&nbsp;Traffic splitting</a>
              <ul id="topicSubGroup-2-3" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../knative-serving/traffic-splitting/traffic-splitting-overview.html">Traffic splitting overview</a></li>
                  <li><a class="" href="../knative-serving/traffic-splitting/traffic-spec-examples.html">Traffic spec examples</a></li>
                  <li><a class="" href="../knative-serving/traffic-splitting/traffic-splitting-using-cli.html">Traffic splitting using the CLI</a></li>
                  <li><a class="" href="../knative-serving/traffic-splitting/traffic-splitting-flags.html">CLI flags for traffic splitting</a></li>
                  <li><a class="" href="../knative-serving/traffic-splitting/traffic-splitting-revisions.html">Splitting traffic between revisions</a></li>
                  <li><a class="" href="../knative-serving/traffic-splitting/traffic-splitting-blue-green.html">Reroute traffic using blue-green strategy</a></li>              </ul>
            </li>
            <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-2-4"><span id="sgSpan-2-4" class="fa fa-caret-right"></span>&nbsp;External and Ingress routing</a>
              <ul id="topicSubGroup-2-4" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../knative-serving/external-ingress-routing/routing-overview.html">Routing overview</a></li>
                  <li><a class="" href="../knative-serving/external-ingress-routing/customize-labels-annotations-routes.html">Customizing labels and annotations</a></li>
                  <li><a class="" href="../knative-serving/external-ingress-routing/configuring-service-routes.html">Configuring routes for Knative services</a></li>
                  <li><a class="" href="../knative-serving/external-ingress-routing/https-redirect-global.html">Global HTTPS redirection</a></li>
                  <li><a class="" href="../knative-serving/external-ingress-routing/url-scheme-external-routes.html">URL scheme for external routes</a></li>
                  <li><a class="" href="../knative-serving/external-ingress-routing/https-redirect-per-service.html">HTTPS redirection per service</a></li>
                  <li><a class="" href="../knative-serving/external-ingress-routing/cluster-local-availability.html">Cluster local availability</a></li>
                  <li><a class="" href="../knative-serving/external-ingress-routing/kourier-gateway-service-type.html">Kourier Gateway service type</a></li>
                  <li><a class="" href="../knative-serving/external-ingress-routing/using-http2-gRPC.html">Using HTTP2 and gRPC</a></li>              </ul>
            </li>
            <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-2-5"><span id="sgSpan-2-5" class="fa fa-caret-right"></span>&nbsp;Configuring access to Knative services</a>
              <ul id="topicSubGroup-2-5" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../knative-serving/config-access/serverless-ossm-with-kourier-jwt.html">Configuring JSON Web Token authentication for Knative services</a></li>
                  <li><a class="" href="../knative-serving/config-access/serverless-ossm-v2x-jwt.html">Using JSON Web Token authentication with Service Mesh 2.x</a></li>
                  <li><a class="" href="../knative-serving/config-access/serverless-ossm-v1x-jwt.html">Using JSON Web Token authentication with Service Mesh 1.x</a></li>              </ul>
            </li>
            <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-2-6"><span id="sgSpan-2-6" class="fa fa-caret-right"></span>&nbsp;Configuring custom domains for Knative services</a>
              <ul id="topicSubGroup-2-6" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../knative-serving/config-custom-domains/serverless-custom-domains.html">Configuring custom domains overview</a></li>
                  <li><a class="" href="../knative-serving/config-custom-domains/create-domain-mapping.html">Custom domain mapping</a></li>
                  <li><a class="" href="../knative-serving/config-custom-domains/create-domain-mapping-kn.html">Custom domains using the Knative CLI</a></li>
                  <li><a class="" href="../knative-serving/config-custom-domains/domain-mapping-odc-developer.html">Domain mapping using the Developer perspective</a></li>
                  <li><a class="" href="../knative-serving/config-custom-domains/domain-mapping-odc-admin.html">Domain mapping using the Administrator perspective</a></li>
                  <li><a class="" href="../knative-serving/config-custom-domains/domain-mapping-custom-tls-cert.html">Securing a mapped service using a TLS certificate</a></li>              </ul>
            </li>
            <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-2-7"><span id="sgSpan-2-7" class="fa fa-caret-right"></span>&nbsp;Configuring high availability for Knative services</a>
              <ul id="topicSubGroup-2-7" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../knative-serving/config-ha-services/ha-services-overview.html">High availability for Knative services overview</a></li>
                  <li><a class="" href="../knative-serving/config-ha-services/ha-replicas-serving.html">High availability for Knative services</a></li>              </ul>
            </li>
      </ul>
    </li>
    <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup3"><span id="tgSpan3" class="fa fa-angle-right"></span>Eventing</a>
      <ul id="topicGroup3" class="collapse  list-unstyled">
            <li><a class="" href="../eventing/knative-eventing.html">Knative Eventing</a></li>
            <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-3-1"><span id="sgSpan-3-1" class="fa fa-caret-right"></span>&nbsp;Event sources</a>
              <ul id="topicSubGroup-3-1" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../eventing/event-sources/knative-event-sources.html">Event sources overview</a></li>
                  <li><a class="" href="../eventing/event-sources/event-source-admin-perspective.html">Event source in the Administrator perspective</a></li>
                  <li><a class="" href="../eventing/event-sources/serverless-apiserversource.html">Creating an API server source</a></li>
                  <li><a class="" href="../eventing/event-sources/serverless-pingsource.html">Creating a ping source</a></li>
                  <li><a class="" href="../eventing/event-sources/serverless-kafka-developer-source.html">Source for Apache Kafka</a></li>
                  <li><a class="" href="../eventing/event-sources/serverless-custom-event-sources.html">Custom event sources</a></li>
                  <li><a class="" href="../eventing/event-sources/serverless-sink-source-odc.html">Connecting an event source to a sink using the Developer perspective</a></li>              </ul>
            </li>
            <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-3-2"><span id="sgSpan-3-2" class="fa fa-caret-right"></span>&nbsp;Event sinks</a>
              <ul id="topicSubGroup-3-2" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../eventing/event-sinks/serverless-event-sinks.html">Event sinks overview</a></li>
                  <li><a class="" href="../eventing/event-sinks/serverless-creating-sinks.html">Creating event sinks</a></li>
                  <li><a class="" href="../eventing/event-sinks/serverless-kafka-developer-sink.html">Sink for Apache Kafka</a></li>              </ul>
            </li>
            <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-3-3"><span id="sgSpan-3-3" class="fa fa-caret-right"></span>&nbsp;Brokers</a>
              <ul id="topicSubGroup-3-3" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../eventing/brokers/serverless-brokers.html">Brokers overview</a></li>
                  <li><a class="" href="../eventing/brokers/serverless-broker-types.html">Broker types</a></li>
                  <li><a class="" href="../eventing/brokers/serverless-using-brokers.html">Creating brokers</a></li>
                  <li><a class="" href="../eventing/brokers/serverless-broker-backing-channel-default.html">Configuring the default broker backing channel</a></li>
                  <li><a class="" href="../eventing/brokers/serverless-global-config-broker-class-default.html">Configuring the default broker class</a></li>
                  <li><a class="" href="../eventing/brokers/kafka-broker.html">Knative broker for Apache Kafka</a></li>
                  <li><a class="" href="../eventing/brokers/serverless-using-brokers-managing-brokers.html">Managing brokers</a></li>
                  <li><a class="" href="../eventing/brokers/serverless-event-delivery.html">Event delivery</a></li>              </ul>
            </li>
            <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-3-4"><span id="sgSpan-3-4" class="fa fa-caret-right"></span>&nbsp;Triggers</a>
              <ul id="topicSubGroup-3-4" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../eventing/triggers/serverless-triggers.html">Triggers overview</a></li>
                  <li><a class="" href="../eventing/triggers/create-triggers.html">Creating triggers</a></li>
                  <li><a class="" href="../eventing/triggers/list-triggers-cli.html">List triggers from the command line</a></li>
                  <li><a class="" href="../eventing/triggers/describe-triggers-cli.html">Describe triggers from the command line</a></li>
                  <li><a class="" href="../eventing/triggers/connect-trigger-sink.html">Connecting a trigger to a sink</a></li>
                  <li><a class="" href="../eventing/triggers/filter-triggers-cli.html">Filtering triggers from the command line</a></li>
                  <li><a class="" href="../eventing/triggers/update-triggers-cli.html">Updating triggers from the command line</a></li>
                  <li><a class="" href="../eventing/triggers/delete-triggers-cli.html">Deleting triggers from the command line</a></li>              </ul>
            </li>
            <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-3-5"><span id="sgSpan-3-5" class="fa fa-caret-right"></span>&nbsp;Channels</a>
              <ul id="topicSubGroup-3-5" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../eventing/channels/serverless-channels.html">Channels and subscriptions</a></li>
                  <li><a class="" href="../eventing/channels/serverless-creating-channels.html">Creating channels</a></li>
                  <li><a class="" href="../eventing/channels/connecting-channels-sinks.html">Connecting channels to sinks</a></li>
                  <li><a class="" href="../eventing/channels/serverless-channel-default.html">Default channel implementation</a></li>
                  <li><a class="" href="../eventing/channels/serverless-kafka-admin-security-channels.html">Security configuration for channels</a></li>              </ul>
            </li>
            <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-3-6"><span id="sgSpan-3-6" class="fa fa-caret-right"></span>&nbsp;Subscriptions</a>
              <ul id="topicSubGroup-3-6" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../eventing/subscriptions/serverless-subs.html">Creating subscriptions</a></li>
                  <li><a class="" href="../eventing/subscriptions/serverless-subs-managing.html">Managing subscriptions</a></li>              </ul>
            </li>
            <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-3-7"><span id="sgSpan-3-7" class="fa fa-caret-right"></span>&nbsp;Event discovery</a>
              <ul id="topicSubGroup-3-7" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../eventing/discovery/serverless-listing-event-sources.html">Listing event sources and event source types</a></li>
                  <li><a class="" href="../eventing/discovery/list-event-source-types-cli.html">Listing event source types from the command line</a></li>
                  <li><a class="" href="../eventing/discovery/list-event-source-types-odc.html">Listing event source types from the Developer perspective</a></li>
                  <li><a class="" href="../eventing/discovery/list-event-sources-cli.html">Listing event sources from the command line</a></li>              </ul>
            </li>
            <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-3-8"><span id="sgSpan-3-8" class="fa fa-caret-right"></span>&nbsp;Tuning eventing configuration</a>
              <ul id="topicSubGroup-3-8" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../eventing/tuning/overriding-config-eventing.html">Overriding deployment configurations</a></li>
                  <li><a class="" href="../eventing/tuning/serverless-ha.html">High availability</a></li>              </ul>
            </li>
      </ul>
    </li>
    <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup4"><span id="tgSpan4" class="fa fa-angle-right"></span>Functions</a>
      <ul id="topicGroup4" class="collapse  list-unstyled">
            <li><a class="" href="../functions/serverless-functions-setup.html">Setting up OpenShift Serverless Functions</a></li>
            <li><a class="" href="../functions/serverless-functions-getting-started.html">Getting started with functions</a></li>
            <li><a class="" href="../functions/serverless-functions-on-cluster-builds.html">On-cluster function building and deploying</a></li>
            <li><a class="" href="../functions/serverless-developing-quarkus-functions.html">Developing Quarkus functions</a></li>
            <li><a class="" href="../functions/serverless-developing-nodejs-functions.html">Developing Node.js functions</a></li>
            <li><a class="" href="../functions/serverless-developing-typescript-functions.html">Developing TypeScript functions</a></li>
            <li><a class="" href="../functions/serverless-developing-python-functions.html">Developing Python functions</a></li>
            <li><a class="" href="../functions/serverless-functions-eventing.html">Using functions with Knative Eventing</a></li>
            <li><a class="" href="../functions/serverless-functions-yaml.html">Function project configuration in func.yaml</a></li>
            <li><a class="" href="../functions/serverless-functions-accessing-secrets-configmaps.html">Accessing secrets and config maps from functions</a></li>
            <li><a class="" href="../functions/serverless-functions-annotations.html">Adding annotations to functions</a></li>
            <li><a class="" href="../functions/serverless-functions-reference-guide.html">Functions development reference guide</a></li>
      </ul>
    </li>
    <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup5"><span id="tgSpan5" class="fa fa-angle-right"></span>Knative CLI</a>
      <ul id="topicGroup5" class="collapse  list-unstyled">
            <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-5-0"><span id="sgSpan-5-0" class="fa fa-caret-right"></span>&nbsp;Knative Serving CLI commands</a>
              <ul id="topicSubGroup-5-0" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../cli_tools/serving_cli/kn-service.html">kn service commands</a></li>
                  <li><a class="" href="../cli_tools/serving_cli/kn-service-offline.html">kn service commands in offline mode</a></li>
                  <li><a class="" href="../cli_tools/serving_cli/kn-container.html">kn container commands</a></li>
                  <li><a class="" href="../cli_tools/serving_cli/kn-domain.html">kn domain commands</a></li>              </ul>
            </li>
            <li><a class="" href="../cli_tools/advanced-kn-config.html">Configuring the Knative CLI</a></li>
            <li><a class="" href="../cli_tools/kn-plugins.html">Knative CLI plugins</a></li>
            <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-5-3"><span id="sgSpan-5-3" class="fa fa-caret-right"></span>&nbsp;Knative Eventing CLI commands</a>
              <ul id="topicSubGroup-5-3" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../cli_tools/eventing_cli/kn-source.html">kn source commands</a></li>              </ul>
            </li>
            <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-5-4"><span id="sgSpan-5-4" class="fa fa-caret-right"></span>&nbsp;Knative Functions CLI commands</a>
              <ul id="topicSubGroup-5-4" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../cli_tools/functions_cli/kn-functions.html">kn functions commands</a></li>              </ul>
            </li>
      </ul>
    </li>
    <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup6"><span id="tgSpan6" class="fa fa-angle-right"></span>Observability</a>
      <ul id="topicGroup6" class="collapse  list-unstyled">
            <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-6-0"><span id="sgSpan-6-0" class="fa fa-caret-right"></span>&nbsp;Administrator metrics</a>
              <ul id="topicSubGroup-6-0" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../observability/admin-metrics/serverless-admin-metrics.html">Administrator metrics overview</a></li>
                  <li><a class="" href="../observability/admin-metrics/serverless-controller-metrics.html">Controller metrics</a></li>
                  <li><a class="" href="../observability/admin-metrics/serverless-webhook-metrics.html">Webhook metrics</a></li>
                  <li><a class="" href="../observability/admin-metrics/serverless-admin-metrics-eventing.html">Knative Eventing metrics</a></li>
                  <li><a class="" href="../observability/admin-metrics/serverless-admin-metrics-serving.html">Knative Serving metrics</a></li>              </ul>
            </li>
            <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-6-1"><span id="sgSpan-6-1" class="fa fa-caret-right"></span>&nbsp;Developer metrics</a>
              <ul id="topicSubGroup-6-1" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../observability/developer-metrics/serverless-developer-metrics.html">Developer metrics overview</a></li>
                  <li><a class="" href="../observability/developer-metrics/serverless-monitoring-services-default-metrics.html">Default Knative service metrics</a></li>
                  <li><a class="" href="../observability/developer-metrics/serverless-monitoring-services-custom-metrics.html">Custom Knative service metrics</a></li>
                  <li><a class="" href="../observability/developer-metrics/serverless-monitoring-services-configuration-scraping.html">Configuration for scraping custom metrics</a></li>
                  <li><a class="" href="../observability/developer-metrics/serverless-monitoring-services-examining-metrics.html">Examining metrics of a service</a></li>
                  <li><a class="" href="../observability/developer-metrics/serverless-developer-metrics-dashboard.html">Dashboard for service metrics</a></li>              </ul>
            </li>
            <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-6-2"><span id="sgSpan-6-2" class="fa fa-caret-right"></span>&nbsp;Cluster logging</a>
              <ul id="topicSubGroup-6-2" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../observability/cluster-logging/cluster-logging-serverless.html">Using OpenShift Logging with Serverless</a></li>
                  <li><a class="" href="../observability/cluster-logging/finding-serving-logs-components.html">Finding logs for Knative Serving components</a></li>
                  <li><a class="" href="../observability/cluster-logging/finding-serving-logs-services.html">Finding logs for Knative Serving services</a></li>              </ul>
            </li>
            <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-6-3"><span id="sgSpan-6-3" class="fa fa-caret-right"></span>&nbsp;Tracing</a>
              <ul id="topicSubGroup-6-3" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../observability/tracing/serverless-tracing.html">Tracing requests</a></li>
                  <li><a class="" href="../observability/tracing/serverless-tracing-open-telemetry.html">Using Red Hat OpenShift distributed tracing</a></li>
                  <li><a class="" href="../observability/tracing/serverless-tracing-jaeger.html">Using Jaeger distributed tracing</a></li>              </ul>
            </li>
      </ul>
    </li>
    <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup7"><span id="tgSpan7" class="fa fa-angle-down"></span>Integrations</a>
      <ul id="topicGroup7" class="collapse in list-unstyled">
            <li><a class=" active" href="../integrations/serverless-ossm-setup.html">Integrating Service Mesh with OpenShift Serverless</a></li>
            <li><a class="" href="../integrations/serverless-cost-management-integration.html">Integrating Serverless with the cost management service</a></li>
            <li><a class="" href="../integrations/gpu-resources.html">Using NVIDIA GPU resources with serverless applications</a></li>
      </ul>
    </li>
    <li class="nav-header"><a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup8"><span id="tgSpan8" class="fa fa-angle-right"></span>Removing Serverless</a>
      <ul id="topicGroup8" class="collapse  list-unstyled">
            <li><a class="" href="../removing/removing-openshift-serverless.html">Removing Serverless overview</a></li>
            <li><a class="" href="../removing/uninstalling-knative-eventing.html">Uninstalling Knative Eventing</a></li>
            <li><a class="" href="../removing/uninstalling-knative-serving.html">Uninstalling Knative Serving</a></li>
            <li><a class="" href="../removing/removing-serverless-operator.html">Removing Serverless Operator</a></li>
            <li><a class="" href="../removing/deleting-serverless-crds.html">Deleting Serverless CRDs</a></li>
      </ul>
    </li>
</ul>
      </div>
      <div id="hc-search-modal">
        <div id="hc-modal-content">
          <span id="hc-modal-close">&times;</span>
          <div id="hc-search-results-wrapper">
            <div id="hc-search-results"></div>
            <div id="hc-search-progress-indicator" class="text-center search-progress-indicator"><i class="fa fa-circle-o-notch fa-spin" style="font-size:42px"></i></div>
            <div class="text-center">
              <button id="hc-search-more-btn">Show more results</button>
            </div>
          </div>
        </div>
      </div>
      <div class="print-logo" style="display:none;">
        <img src="https://www.redhat.com/cms/managed-files/Logo-Red_Hat-OpenShift-A-Standard-RGB_0_0.svg" alt="print logo"/>
      </div>
      <div class="col-xs-12 col-sm-9 col-md-9 main">
        <div class="page-header">
          <h1>
            Integrating Service Mesh with OpenShift Serverless
          </h1>
        </div>
        
        
        <div id="preamble">
<div class="sectionbody">
<div id="toc" class="toc">
<div id="toctitle" class="title"></div>
<ul class="sectlevel1">
<li><a href="#prerequsites_serverless-ossm-setup">Prerequisites</a></li>
<li><a href="#serverlesss-ossm-external-certs_serverless-ossm-setup">Creating a certificate to encrypt incoming external traffic</a></li>
<li><a href="#serverless-ossm-setup_serverless-ossm-setup">Integrating Service Mesh with OpenShift Serverless</a></li>
<li><a href="#serverless-ossm-enabling-serving-metrics_serverless-ossm-setup">Enabling Knative Serving metrics when using Service Mesh with mTLS</a></li>
<li><a href="#serverless-ossm-setup-with-kourier_serverless-ossm-setup">Integrating Service Mesh with OpenShift Serverless when Kourier is enabled</a></li>
<li><a href="#serverless-ossm-secret-filtering-net-istio_serverless-ossm-setup">Improving net-istio memory usage by using secret filtering for Service Mesh</a></li>
</ul>
</div>
<div class="paragraph">
<p>The OpenShift Serverless Operator provides Kourier as the default ingress for Knative. However, you can use Service Mesh with OpenShift Serverless whether Kourier is enabled or not. Integrating with Kourier disabled allows you to configure additional networking and routing options that the Kourier ingress does not support, such as mTLS functionality.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>OpenShift Serverless only supports the use of Red Hat OpenShift Service Mesh functionality that is explicitly documented in this guide, and does not support other undocumented features.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="prerequsites_serverless-ossm-setup"><a class="anchor" href="#prerequsites_serverless-ossm-setup"></a>Prerequisites</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>The examples in the following procedures use the domain <code>example.com</code>. The example certificate for this domain is used as a certificate authority (CA) that signs the subdomain certificate.</p>
<div class="paragraph">
<p>To complete and verify these procedures in your deployment, you need either a certificate signed by a widely trusted public CA or a CA provided by your organization. Example commands must be adjusted according to your domain, subdomain, and CA.</p>
</div>
</li>
<li>
<p>You must configure the wildcard certificate to match the domain of your OpenShift Container Platform cluster. For example, if your OpenShift Container Platform console address is <code><a href="https://console-openshift-console.apps.openshift.example.com" class="bare">https://console-openshift-console.apps.openshift.example.com</a></code>, you must configure the wildcard certificate so that the domain is <code>*.apps.openshift.example.com</code>. For more information about configuring wildcard certificates, see the following topic about <em>Creating a certificate to encrypt incoming external traffic</em>.</p>
</li>
<li>
<p>If you want to use any domain name, including those which are not subdomains of the default OpenShift Container Platform cluster domain, you must set up domain mapping for those domains. For more information, see the OpenShift Serverless documentation about <a href="../knative-serving/config-custom-domains/create-domain-mapping.html#serverless-create-domain-mapping_create-domain-mapping">Creating a custom domain mapping</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="serverlesss-ossm-external-certs_serverless-ossm-setup"><a class="anchor" href="#serverlesss-ossm-external-certs_serverless-ossm-setup"></a>Creating a certificate to encrypt incoming external traffic</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, the Service Mesh mTLS feature only secures traffic inside of the Service Mesh itself, between the ingress gateway and individual pods that have sidecars. To encrypt traffic as it flows into the OpenShift Container Platform cluster, you must generate a certificate before you enable the OpenShift Serverless and Service Mesh integration.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have cluster administrator permissions on OpenShift Container Platform, or you have cluster or dedicated administrator permissions on Red Hat OpenShift Service on AWS or OpenShift Dedicated.</p>
</li>
<li>
<p>You have installed the OpenShift Serverless Operator and Knative Serving.</p>
</li>
<li>
<p>Install the OpenShift CLI (<code>oc</code>).</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a root certificate and private key that signs the certificates for your Knative services:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>openssl req <span class="nt">-x509</span> <span class="nt">-sha256</span> <span class="nt">-nodes</span> <span class="nt">-days</span> 365 <span class="nt">-newkey</span> rsa:2048 <span class="se">\</span>
    <span class="nt">-subj</span> <span class="s1">'/O=Example Inc./CN=example.com'</span> <span class="se">\</span>
    <span class="nt">-keyout</span> root.key <span class="se">\</span>
    <span class="nt">-out</span> root.crt</code></pre>
</div>
</div>
</li>
<li>
<p>Create a wildcard certificate:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>openssl req <span class="nt">-nodes</span> <span class="nt">-newkey</span> rsa:2048 <span class="se">\</span>
    <span class="nt">-subj</span> <span class="s2">"/CN=*.apps.openshift.example.com/O=Example Inc."</span> <span class="se">\</span>
    <span class="nt">-keyout</span> wildcard.key <span class="se">\</span>
    <span class="nt">-out</span> wildcard.csr</code></pre>
</div>
</div>
</li>
<li>
<p>Sign the wildcard certificate:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>openssl x509 <span class="nt">-req</span> <span class="nt">-days</span> 365 <span class="nt">-set_serial</span> 0 <span class="se">\</span>
    <span class="nt">-CA</span> root.crt <span class="se">\</span>
    <span class="nt">-CAkey</span> root.key <span class="se">\</span>
    <span class="nt">-in</span> wildcard.csr <span class="se">\</span>
    <span class="nt">-out</span> wildcard.crt</code></pre>
</div>
</div>
</li>
<li>
<p>Create a secret by using the wildcard certificate:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc create <span class="nt">-n</span> istio-system secret tls wildcard-certs <span class="se">\</span>
    <span class="nt">--key</span><span class="o">=</span>wildcard.key <span class="se">\</span>
    <span class="nt">--cert</span><span class="o">=</span>wildcard.crt</code></pre>
</div>
</div>
<div class="paragraph">
<p>This certificate is picked up by the gateways created when you integrate OpenShift Serverless with Service Mesh, so that the ingress gateway serves traffic with this certificate.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="serverless-ossm-setup_serverless-ossm-setup"><a class="anchor" href="#serverless-ossm-setup_serverless-ossm-setup"></a>Integrating Service Mesh with OpenShift Serverless</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can integrate Service Mesh with OpenShift Serverless without using Kourier as the default ingress. To do this, do not install the Knative Serving component before completing the following procedure. There are additional steps required when creating the <code>KnativeServing</code> custom resource definition (CRD) to integrate Knative Serving with Service Mesh, which are not covered in the general Knative Serving installation procedure. This procedure might be useful if you want to integrate Service Mesh as the default and only ingress for your OpenShift Serverless installation.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have cluster administrator permissions on OpenShift Container Platform, or you have cluster or dedicated administrator permissions on Red Hat OpenShift Service on AWS or OpenShift Dedicated.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads.</p>
</li>
<li>
<p>Install the Red Hat OpenShift Service Mesh Operator and create a <code>ServiceMeshControlPlane</code> resource in the <code>istio-system</code> namespace. If you want to use mTLS functionality, you must also set the <code>spec.security.dataPlane.mtls</code> field for the <code>ServiceMeshControlPlane</code> resource to <code>true</code>.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Using OpenShift Serverless with Service Mesh is only supported with Red Hat OpenShift Service Mesh version 2.0.5 or later.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Install the OpenShift Serverless Operator.</p>
</li>
<li>
<p>Install the OpenShift CLI (<code>oc</code>).</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Add the namespaces that you would like to integrate with Service Mesh to the <code>ServiceMeshMemberRoll</code> object as members:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">maistra.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ServiceMeshMemberRoll</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">default</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">istio-system</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">members</span><span class="pi">:</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="pi">-</span> <span class="s">knative-serving</span>
    <span class="pi">-</span> <span class="s">&lt;namespace&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A list of namespaces to be integrated with Service Mesh.</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This list of namespaces must include the <code>knative-serving</code> namespace.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Apply the <code>ServiceMeshMemberRoll</code> resource:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc apply <span class="nt">-f</span> &lt;filename&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Create the necessary gateways so that Service Mesh can accept traffic:</p>
<div class="listingblock">
<div class="title">Example <code>knative-local-gateway</code> object using HTTP</div>
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">networking.istio.io/v1alpha3</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Gateway</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">knative-ingress-gateway</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">knative-serving</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">istio</span><span class="pi">:</span> <span class="s">ingressgateway</span>
  <span class="na">servers</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">port</span><span class="pi">:</span>
        <span class="na">number</span><span class="pi">:</span> <span class="m">443</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">https</span>
        <span class="na">protocol</span><span class="pi">:</span> <span class="s">HTTPS</span>
      <span class="na">hosts</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">*"</span>
      <span class="na">tls</span><span class="pi">:</span>
        <span class="na">mode</span><span class="pi">:</span> <span class="s">SIMPLE</span>
        <span class="na">credentialName</span><span class="pi">:</span> <span class="s">&lt;wildcard_certs&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">networking.istio.io/v1alpha3</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Gateway</span>
<span class="na">metadata</span><span class="pi">:</span>
 <span class="na">name</span><span class="pi">:</span> <span class="s">knative-local-gateway</span>
 <span class="na">namespace</span><span class="pi">:</span> <span class="s">knative-serving</span>
<span class="na">spec</span><span class="pi">:</span>
 <span class="na">selector</span><span class="pi">:</span>
   <span class="na">istio</span><span class="pi">:</span> <span class="s">ingressgateway</span>
 <span class="na">servers</span><span class="pi">:</span>
   <span class="pi">-</span> <span class="na">port</span><span class="pi">:</span>
       <span class="na">number</span><span class="pi">:</span> <span class="m">8081</span>
       <span class="na">name</span><span class="pi">:</span> <span class="s">http</span>
       <span class="na">protocol</span><span class="pi">:</span> <span class="s">HTTP</span> <i class="conum" data-value="2"></i><b>(2)</b>
     <span class="na">hosts</span><span class="pi">:</span>
       <span class="pi">-</span> <span class="s2">"</span><span class="s">*"</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">metadata</span><span class="pi">:</span>
 <span class="na">name</span><span class="pi">:</span> <span class="s">knative-local-gateway</span>
 <span class="na">namespace</span><span class="pi">:</span> <span class="s">istio-system</span>
 <span class="na">labels</span><span class="pi">:</span>
   <span class="s">experimental.istio.io/disable-gateway-port-translation</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
<span class="na">spec</span><span class="pi">:</span>
 <span class="na">type</span><span class="pi">:</span> <span class="s">ClusterIP</span>
 <span class="na">selector</span><span class="pi">:</span>
   <span class="na">istio</span><span class="pi">:</span> <span class="s">ingressgateway</span>
 <span class="na">ports</span><span class="pi">:</span>
   <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">http2</span>
     <span class="na">port</span><span class="pi">:</span> <span class="m">80</span>
     <span class="na">targetPort</span><span class="pi">:</span> <span class="s">8081</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Add the name of the secret that contains the wildcard certificate.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>knative-local-gateway</code> serves HTTP traffic. Using HTTP means that traffic coming from outside of Service Mesh, but using an internal hostname, such as <code>example.default.svc.cluster.local</code>, is not encrypted. You can set up encryption for this path by creating another wildcard certificate and an additional gateway that uses a different <code>protocol</code> spec.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example <code>knative-local-gateway</code> object using HTTPS</div>
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">networking.istio.io/v1alpha3</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Gateway</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">knative-local-gateway</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">knative-serving</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">istio</span><span class="pi">:</span> <span class="s">ingressgateway</span>
  <span class="na">servers</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">port</span><span class="pi">:</span>
        <span class="na">number</span><span class="pi">:</span> <span class="m">443</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">https</span>
        <span class="na">protocol</span><span class="pi">:</span> <span class="s">HTTPS</span>
      <span class="na">hosts</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">*"</span>
      <span class="na">tls</span><span class="pi">:</span>
        <span class="na">mode</span><span class="pi">:</span> <span class="s">SIMPLE</span>
        <span class="na">credentialName</span><span class="pi">:</span> <span class="s">&lt;wildcard_certs&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>Apply the <code>Gateway</code> resources:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc apply <span class="nt">-f</span> &lt;filename&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Install Knative Serving by creating the following <code>KnativeServing</code> custom resource definition (CRD), which also enables the Istio integration:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">operator.knative.dev/v1beta1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">KnativeServing</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">knative-serving</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">knative-serving</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">ingress</span><span class="pi">:</span>
    <span class="na">istio</span><span class="pi">:</span>
      <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span> <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="na">deployments</span><span class="pi">:</span> <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">activator</span>
    <span class="na">annotations</span><span class="pi">:</span>
      <span class="s2">"</span><span class="s">sidecar.istio.io/inject"</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
      <span class="s2">"</span><span class="s">sidecar.istio.io/rewriteAppHTTPProbers"</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">autoscaler</span>
    <span class="na">annotations</span><span class="pi">:</span>
      <span class="s2">"</span><span class="s">sidecar.istio.io/inject"</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
      <span class="s2">"</span><span class="s">sidecar.istio.io/rewriteAppHTTPProbers"</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Enables Istio integration.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Enables sidecar injection for Knative Serving data plane pods.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Apply the <code>KnativeServing</code> resource:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc apply <span class="nt">-f</span> &lt;filename&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Create a Knative Service that has sidecar injection enabled and uses a pass-through route:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">serving.knative.dev/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">&lt;service_name&gt;</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">&lt;namespace&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="na">annotations</span><span class="pi">:</span>
    <span class="s">serving.knative.openshift.io/enablePassthrough</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span> <i class="conum" data-value="2"></i><b>(2)</b>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">annotations</span><span class="pi">:</span>
        <span class="s">sidecar.istio.io/inject</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span> <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="s">sidecar.istio.io/rewriteAppHTTPProbers</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">image</span><span class="pi">:</span> <span class="s">&lt;image_url&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A namespace that is part of the Service Mesh member roll.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Instructs Knative Serving to generate an OpenShift Container Platform pass-through enabled route, so that the certificates you have generated are served through the ingress gateway directly.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Injects Service Mesh sidecars into the Knative service pods.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Apply the <code>Service</code> resource:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc apply <span class="nt">-f</span> &lt;filename&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>Access your serverless application by using a secure connection that is now trusted by the CA:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>curl <span class="nt">--cacert</span> root.crt &lt;service_url&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example command</div>
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>curl <span class="nt">--cacert</span> root.crt https://hello-default.apps.openshift.example.com</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="go">Hello Openshift!</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="serverless-ossm-enabling-serving-metrics_serverless-ossm-setup"><a class="anchor" href="#serverless-ossm-enabling-serving-metrics_serverless-ossm-setup"></a>Enabling Knative Serving metrics when using Service Mesh with mTLS</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If Service Mesh is enabled with mTLS, metrics for Knative Serving are disabled by default, because Service Mesh prevents Prometheus from scraping metrics. This section shows how to enable Knative Serving metrics when using Service Mesh and mTLS.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have installed the OpenShift Serverless Operator and Knative Serving on your cluster.</p>
</li>
<li>
<p>You have installed Red Hat OpenShift Service Mesh with the mTLS functionality enabled.</p>
</li>
<li>
<p>You have cluster administrator permissions on OpenShift Container Platform, or you have cluster or dedicated administrator permissions on Red Hat OpenShift Service on AWS or OpenShift Dedicated.</p>
</li>
<li>
<p>Install the OpenShift CLI (<code>oc</code>).</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Specify <code>prometheus</code> as the <code>metrics.backend-destination</code> in the <code>observability</code> spec of the Knative Serving custom resource (CR):</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">operator.knative.dev/v1beta1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">KnativeServing</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">knative-serving</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">config</span><span class="pi">:</span>
    <span class="na">observability</span><span class="pi">:</span>
      <span class="s">metrics.backend-destination</span><span class="pi">:</span> <span class="s2">"</span><span class="s">prometheus"</span>
<span class="nn">...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This step prevents metrics from being disabled by default.</p>
</div>
</li>
<li>
<p>Apply the following network policy to allow traffic from the Prometheus namespace:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">networking.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">NetworkPolicy</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">allow-from-openshift-monitoring-ns</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">knative-serving</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">ingress</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">from</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">namespaceSelector</span><span class="pi">:</span>
        <span class="na">matchLabels</span><span class="pi">:</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">openshift-monitoring"</span>
  <span class="na">podSelector</span><span class="pi">:</span> <span class="pi">{}</span>
<span class="nn">...</span></code></pre>
</div>
</div>
</li>
<li>
<p>Modify and reapply the default Service Mesh control plane in the <code>istio-system</code> namespace, so that it includes the following spec:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="yaml"><span class="nn">...</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">proxy</span><span class="pi">:</span>
    <span class="na">networking</span><span class="pi">:</span>
      <span class="na">trafficControl</span><span class="pi">:</span>
        <span class="na">inbound</span><span class="pi">:</span>
          <span class="na">excludedPorts</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="m">8444</span>
<span class="nn">...</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="serverless-ossm-setup-with-kourier_serverless-ossm-setup"><a class="anchor" href="#serverless-ossm-setup-with-kourier_serverless-ossm-setup"></a>Integrating Service Mesh with OpenShift Serverless when Kourier is enabled</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can use Service Mesh with OpenShift Serverless even if Kourier is already enabled. This procedure might be useful if you have already installed Knative Serving with Kourier enabled, but decide to add a Service Mesh integration later.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have cluster administrator permissions on OpenShift Container Platform, or you have cluster or dedicated administrator permissions on Red Hat OpenShift Service on AWS or OpenShift Dedicated.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads.</p>
</li>
<li>
<p>Install the OpenShift CLI (<code>oc</code>).</p>
</li>
<li>
<p>Install the OpenShift Serverless Operator and Knative Serving on your cluster.</p>
</li>
<li>
<p>Install Red Hat OpenShift Service Mesh. OpenShift Serverless with Service Mesh and Kourier is supported for use with both Red Hat OpenShift Service Mesh versions 1.x and 2.x.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Add the namespaces that you would like to integrate with Service Mesh to the <code>ServiceMeshMemberRoll</code> object as members:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">maistra.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ServiceMeshMemberRoll</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">default</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">istio-system</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">members</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">&lt;namespace&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="nn">...</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A list of namespaces to be integrated with Service Mesh.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Apply the <code>ServiceMeshMemberRoll</code> resource:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc apply <span class="nt">-f</span> &lt;filename&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Create a network policy that permits traffic flow from Knative system pods to Knative services:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>For each namespace that you want to integrate with Service Mesh, create a <code>NetworkPolicy</code> resource:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">networking.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">NetworkPolicy</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">allow-from-serving-system-namespace</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">&lt;namespace&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">ingress</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">from</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">namespaceSelector</span><span class="pi">:</span>
        <span class="na">matchLabels</span><span class="pi">:</span>
          <span class="s">knative.openshift.io/part-of</span><span class="pi">:</span> <span class="s2">"</span><span class="s">openshift-serverless"</span>
  <span class="na">podSelector</span><span class="pi">:</span> <span class="pi">{}</span>
  <span class="na">policyTypes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">Ingress</span>
<span class="nn">...</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Add the namespace that you want to integrate with Service Mesh.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>knative.openshift.io/part-of: "openshift-serverless"</code> label was added in OpenShift Serverless 1.22.0. If you are using OpenShift Serverless 1.21.1 or earlier, add the <code>knative.openshift.io/part-of</code> label to the <code>knative-serving</code> and <code>knative-serving-ingress</code> namespaces.</p>
</div>
<div class="paragraph">
<p>Add the label to the <code>knative-serving</code> namespace:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc label namespace knative-serving knative.openshift.io/part-of<span class="o">=</span>openshift-serverless</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add the label to the <code>knative-serving-ingress</code> namespace:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc label namespace knative-serving-ingress knative.openshift.io/part-of<span class="o">=</span>openshift-serverless</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Apply the <code>NetworkPolicy</code> resource:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc apply <span class="nt">-f</span> &lt;filename&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="serverless-ossm-secret-filtering-net-istio_serverless-ossm-setup"><a class="anchor" href="#serverless-ossm-secret-filtering-net-istio_serverless-ossm-setup"></a>Improving net-istio memory usage by using secret filtering for Service Mesh</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, the <a href="https://aly.arriqaaq.com/kubernetes-informers/">informers</a> implementation for the Kubernetes <code>client-go</code> library fetches all resources of a particular type. This can lead to a substantial overhead when many resources are available, which can cause the Knative <code>net-istio</code> ingress controller to fail on large clusters due to memory leaking. However, a filtering mechanism is available for the Knative <code>net-istio</code> ingress controller, which enables the controller to only fetch Knative related secrets. You can enable this mechanism by adding an annotation to the <code>KnativeServing</code> custom resource (CR).</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you enable secret filtering, all of your secrets need to be labeled with  <code>networking.internal.knative.dev/certificate-uid: "&lt;id&gt;"</code>. Otherwise, Knative Serving does not detect them, which leads to failures. You must label both new and existing secrets.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have cluster administrator permissions on OpenShift Container Platform, or you have cluster or dedicated administrator permissions on Red Hat OpenShift Service on AWS or OpenShift Dedicated.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads.</p>
</li>
<li>
<p>Install Red Hat OpenShift Service Mesh. OpenShift Serverless with Service Mesh only is supported for use with Red Hat OpenShift Service Mesh version 2.0.5 or later.</p>
</li>
<li>
<p>Install the OpenShift Serverless Operator and Knative Serving.</p>
</li>
<li>
<p>Install the OpenShift CLI (<code>oc</code>).</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Add the <code>serverless.openshift.io/enable-secret-informer-filtering</code> annotation to the <code>KnativeServing</code> CR:</p>
<div class="listingblock">
<div class="title">Example KnativeServing CR</div>
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">operator.knative.dev/v1beta1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">KnativeServing</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">knative-serving</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">knative-serving</span>
  <span class="na">annotations</span><span class="pi">:</span>
    <span class="s">serverless.openshift.io/enable-secret-informer-filtering</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">ingress</span><span class="pi">:</span>
    <span class="na">istio</span><span class="pi">:</span>
      <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">deployments</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">annotations</span><span class="pi">:</span>
        <span class="s">sidecar.istio.io/inject</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
        <span class="s">sidecar.istio.io/rewriteAppHTTPProbers</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">activator</span>
    <span class="pi">-</span> <span class="na">annotations</span><span class="pi">:</span>
        <span class="s">sidecar.istio.io/inject</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
        <span class="s">sidecar.istio.io/rewriteAppHTTPProbers</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">autoscaler</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Adding this annotation injects an environment variable, <code>ENABLE_SECRET_INFORMER_FILTERING_BY_CERT_UID=true</code>, to the <code>net-istio</code> controller pod.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This annotation is ignored if you set a different value by overriding deployments.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</div>
</div>
      </div>
    </div>
  </div>
  <script src="https://assets.openshift.net/content/modernizr.js" type="text/javascript"></script>
  <script src="https://assets.openshift.net/content/subdomain.js" type="text/javascript"></script>
  <script src="https://assets.openshift.net/content/nav-tertiary.js" type="text/javascript"></script>
  <script src="https://docs.openshift.com/container-platform/4.1/_javascripts/bootstrap-offcanvas.js" type="text/javascript"></script>
  <script src="https://docs.openshift.com/container-platform/4.1/_javascripts/reformat-html.js" type="text/javascript"></script>
  <script src="https://docs.openshift.com/container-platform/4.1/_javascripts/hc-search.js" type="text/javascript"></script>
  <script src="https://docs.openshift.com/container-platform/4.1/_javascripts/page-loader.js" type="text/javascript"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" type="text/javascript"></script>
  <script src="https://docs.openshift.com/container-platform/4.1/_javascripts/clipboard.js" type="text/javascript"></script>
  <script src="https://docs.openshift.com/container-platform/4.1/_javascripts/collapsible.js" type="text/javascript"></script>
  <script>
  var dk = 'openshift-serverless';
  var version = 'Branch Build';

  var distros = {
    'openshift-origin': ['docs_origin', version],
    // specific labels are used for OSD instead of the URL filter, due to its unusual URL structure; assume v4
    'openshift-dedicated': ['docs_dedicated_v4'],
    'openshift-online': ['docs_online', version],
    'openshift-enterprise': ['docs_cp', version],
    'openshift-aro' : ['docs_aro', version],
    'openshift-rosa' : ['docs_rosa'],
    'openshift-acs' : ['docs_acs', version]
  };

  // only OSD v3 docs have the version variable specified
  if (dk == "openshift-dedicated" && version == "3") {
    distros['openshift-dedicated'] = ['docs_dedicated_v3']
  }

  distros[dk] ? hcSearchCategory.apply(null, distros[dk]) : hcSearchCategory("docs");
  </script>
  <script type="text/javascript">
  /*<![CDATA[*/
  $(document).ready(function() {
    $("[id^='topicGroup']").on('show.bs.collapse', function(event) {
      if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
        $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
      }
    });
    $("[id^='topicGroup']").on('hide.bs.collapse', function(event) {
      if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
        $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
      }
    });
    $("[id^='topicSubGroup']").on('show.bs.collapse', function() {
      $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
    });
    $("[id^='topicSubGroup']").on('hide.bs.collapse', function() {
      $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
    });
    $("[id^='topicSubSubGroup']").on('show.bs.collapse', function() {
      $(this).parent().find("[id^='ssgSpan']").toggleClass("fa-caret-right fa-caret-down");
    });
    $("[id^='topicSubSubGroup']").on('hide.bs.collapse', function() {
      $(this).parent().find("[id^='ssgSpan']").toggleClass("fa-caret-right fa-caret-down");
    });

    const collapsibleContent = document.getElementsByTagName("details");
    for (var i = 0; i < collapsibleContent.length; i++) {
      collapsibleContent[i].setAttribute("open", "");
    }

  });
  /*]]>*/
  </script>

  <footer id="rh">

    <div class="container">
        <div class="row">

            <div class="col-sm-2">
                <img src="https://assets.openshift.com/hubfs/images/logos/Logo-RedHat-A-Reverse-RGB.svg" class="img-fluid" alt="Red Hat" style="height: 30px;">
            </div>

            <div class="col-sm-3">
              <p class="text-nowrap">Copyright  2023 Red Hat, Inc.</p>
            </div>



            <div class="col">
                <nav class="nav">
                    <a target="_blank" href="https://www.redhat.com/en/about/privacy-policy" class="nav-link">Privacy statement</a>
                    <a target="_blank" href="https://www.openshift.com/legal/terms/" class="nav-link">Terms of use</a>
                    <a target="_blank" href="https://www.redhat.com/en/about/all-policies-guidelines" class="nav-link">All policies and guidelines</a>
                    <a id="teconsent"></a>
                </nav>
            </div>
        </div>
    </div>
</footer>
<div id="consent_blackbar" style="z-index: 100; position: fixed"></div>



<!-- Adobe DTM -->
<script type="text/javascript">
if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
   _satellite.pageBottom();
}
</script>
<!-- End Adobe DTM -->

  <!-- adjust page css based on breadcrumb and/or resize -->
  <script type="text/javascript">
    window.addEventListener('DOMContentLoaded', () => {
      if ($(window).width() >= 1008) {
        adjustSide();
        adjustToc();
        adjustMain();
      }
    });

    window.addEventListener('resize', () => {
      if ($(window).width() >= 1008) {
        adjustSide();
        adjustToc();
        adjustMain();
      } else if ($(window).width() < 1008) {
        sidebar.classList.remove('wide');
        document.querySelector('#hc-search').classList.remove('wide');
        if (sidebar.classList.contains('open')) {
          sidebar.style.display = 'block';
        } else {
          sidebar.style.display = 'none';
        }
        document.querySelector('.main').style.paddingTop = '0px';
      }
    });

    function adjustSide() {
      sidebar.classList.add('wide');
      document.querySelector('#hc-search').classList.add('wide');
      sidebar.style.display = 'block';
      document.querySelector('.sidebar').style.top = parseInt((document.querySelector('.breadcrumb').offsetHeight + 125), 10) + "px";
      document.querySelector('#hc-search').style.top = parseInt((document.querySelector('.breadcrumb').offsetHeight + 95), 10) + "px";
    }

    function adjustToc() {
      if (document.querySelector('#toc') !== null) {
        document.querySelector('#toc').style.top = parseInt((document.querySelector('.breadcrumb').offsetHeight + 90), 10) + "px";
      }
    }

    function adjustMain() {
      document.querySelector('html').style.scrollPaddingTop = parseInt((document.querySelector('.breadcrumb').offsetHeight + 90), 10) + "px";
      document.querySelector('.main').style.paddingTop = parseInt((document.querySelector('.breadcrumb').offsetHeight - 70), 10) + "px";
    }

  </script>

  <!-- remove toc active class when page is loaded -->
  <script type="text/javascript">
    window.addEventListener('DOMContentLoaded', () => {
      var tocItems = $("#toc a");

      for (let i = 0; i < tocItems.length; i++) {
        tocItems[i].classList.remove("toc-active");
      }
    })
  </script>

  <!-- maintain sidebar scroll position between page loads -->
  <script type="text/javascript">
    let sidebar = document.querySelector(".sidebar");
    let scrolltop = localStorage.getItem("sidebar-scroll");

    if (scrolltop == null) {
      sidebar.scrollTop = parseInt(top, 10);
    }

    window.addEventListener("beforeunload", () => {
      localStorage.setItem("sidebar-scroll", sidebar.scrollTop);
    });

    window.addEventListener('load', () => {
      sidebar.scrollTo(0, scrolltop)
    })
  </script>

  <!-- open/close the nav -->
  <script type="text/javascript">
    function closeNav() {
      let sidebar = document.querySelector(".sidebar");
      sidebar.style.display = "none";
      sidebar.classList.remove('open');
    }

    function openNav() {
      let sidebar = document.querySelector(".sidebar");
      let hc_search = document.querySelector('#hc-search');
      sidebar.style.display = "block";
      sidebar.style.top = "0px";
      hc_search.style.top = 'unset';
      sidebar.classList.add('open');
    }
  </script>

  <!-- clear and add toc-active to clicked toc link -->
  <script type="text/javascript">
  $("#toc a").click(function() {
    var tocItems = $("#toc a");
    for (let i = 0; i < tocItems.length; i++) {
      tocItems[i].classList.remove("toc-active");
    }
    this.classList.add("toc-active");
  });
  </script>

  <!-- update active toc class when mouse scrolls -->
  <script type="text/javascript">
    window.addEventListener('DOMContentLoaded', () => {
      window.addEventListener("wheel", () => {

        const ioConfiguration = {
          "rootMargin": "-120px 0px -400px 0px",
          "threshold": 0
        };

        const observer = new IntersectionObserver(setCurrent, ioConfiguration, entries => {
          entries.forEach(entry => {
            var id = entry.target.getAttribute('id');
            //fight with js
            document.querySelector(`#toc li a[href="#${id}"]`).classList.remove('toc-active');
          });
        });

        //track all h1-4 headings that have an id
        document.querySelectorAll('.main h2[id], .main h3[id]').forEach((h) => {
          observer.observe(h);
        });

        //runs when the IntersectionObserver fires
        function setCurrent(e) {
          var allTocLinks = document.querySelectorAll("#toc li a");
          if (allTocLinks !== undefined) {
            e.map(i => {
              if (i.isIntersecting && i.intersectionRatio >= 1) {
                allTocLinks.forEach(link => link.classList.remove("toc-active"));
                document.querySelector(`#toc li a[href="#${i.target.id}"]`).classList.add('toc-active')
              }
            })
          }
        };

        //make clicked toc item active and stop IntersectionObserver
        $("#toc a").click(function() {
          //stop tracking all h1-4 headings that have an id
          document.querySelectorAll('.main h2[id], .main h3[id]').forEach((h) => {
            observer.unobserve(h);
          });
          var tocItems = $("#toc a");
          if (tocItems !== undefined) {
            for (let i = 0; i < tocItems.length; i++) {
              tocItems[i].classList.remove("toc-active");
            };
            this.classList.add("toc-active");
          }
        })
      })
    })
  </script>

  <!--handle page scroll top and bottom, add toc-active -->
  <script type="text/javascript">
    document.addEventListener('scroll', () => {
      //scroll to bottom
      if(document.documentElement.scrollHeight === window.pageYOffset + window.innerHeight) {
        var tocItems = $("#toc a");
        for (let i = 0; i < tocItems.length; i++) {
          tocItems[i].classList.remove("toc-active")
          };
          tocItems[tocItems.length - 1].classList.add("toc-active");
        };
      //scroll to top
      if(window.pageYOffset === 0) {
        var tocItems = $("#toc a");
        for (let i = 0; i < tocItems.length; i++) {
          tocItems[i].classList.remove("toc-active");
          };
          tocItems[0].classList.add("toc-active");
        };
      })
  </script>

  <!--adjust sidebar and toc when footer is displayed -->
  <script type="text/javascript">
    sidebar = document.querySelector('.sidebar')
    toc = document.querySelector('#toc')
    main = document.querySelector('.main')
    okd_footer = document.querySelector('.footer-origin-docs')

    //handle short pages
    if (window.innerHeight === document.documentElement.scrollHeight) {
      //sidebar
      if (sidebar !== null && okd_footer == null) {
        sidebar.style.marginBottom = "38px";
        main.style.marginBottom = "35px";
      };
      //okd sidebar
      if(sidebar !== null && okd_footer !== null) {
        sidebar.style.marginBottom = "176px";
        main.style.marginBottom = "135px";
      }
    };

    //handle scrolling pages
    document.addEventListener('scroll', () => {
      //scroll to bottom
      if ($(window).width() >= 1008) {
        if(sidebar !== null) {
          //pages with multiple toc entries
          if(document.documentElement.scrollHeight === window.pageYOffset + window.innerHeight) {
              //sidebar
              if (sidebar !== null && okd_footer == null){
                sidebar.style.marginBottom = "38px";
                main.style.marginBottom = "35px";
              };
              //toc
              if (toc !== null && okd_footer == null){
                toc.style.bottom = "35px";
              };
              //okd sidebar
              if(sidebar !== null && okd_footer !== null) {
                sidebar.style.marginBottom = "176px";
                main.style.marginBottom = "135px";
              };
              //okd toc
              if (toc !== null && okd_footer !== null){
                toc.style.bottom = "175px";
              };
            };
          if(document.documentElement.scrollHeight != window.pageYOffset + window.innerHeight) {
            sidebar.style.marginBottom = "0px";
            if (toc !== null) {
              toc.style.bottom = "0px";
            }
          }
        }
      }
    })
  </script>

  <!-- adjust alerts on mobile -->
  <script type="text/javascript">
    alert = document.querySelector('#support-alert')
    window.addEventListener("wheel", () => {
      if ($(window).width() < 1008) {
        //adjust alert
        if(window.pageYOffset > 0) {
          if(alert !== null) {
            document.querySelector('#support-alert').style.position = "fixed";
            document.querySelector('#support-alert').style.bottom = "0px";
            document.querySelector('#support-alert').style.margin = "5px";
            document.querySelector('#support-alert').style.zIndex = "9999999";
          }
        }
      }
   });
    window.addEventListener('resize', () => {
      if ($(window).width() >= 1008) {
        if(alert !== null) {
          document.querySelector('#support-alert').style.removeProperty('position');
          document.querySelector('#support-alert').style.removeProperty('bottom');
          document.querySelector('#support-alert').style.removeProperty('margin');
          document.querySelector('#support-alert').style.removeProperty('zIndex');
        }
      }
    })
  </script>

</body>
</html>